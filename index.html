<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ColorShop | Cloud Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<style>
  :root { --p: #6a5cff; --bg: #f6f7fb; --card: #fff; --txt: #333; --err: #ff4d4d; --brd: #eeeeee; }
  [data-theme="dark"] { --bg: #121212; --card: #1e1e1e; --txt: #f0f0f0; --brd: #333; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--txt); transition: 0.3s; padding-bottom: 80px; }
  header { background: var(--p); color: #fff; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
  #admin-trigger { cursor: default; user-select: none; }
  .tools { background: var(--card); border-bottom: 1px solid var(--brd); padding: 10px 15px; }
  .search-row { display: flex; gap: 8px; margin-bottom: 10px; }
  #search-bar { flex: 2; padding: 10px 15px; border-radius: 20px; border: 1px solid var(--brd); background: var(--bg); color: var(--txt); outline: none; }
  #sort-select { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid var(--brd); background: var(--bg); color: var(--txt); font-size: 12px; }
  .cats { display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; }
  .cat-btn { padding: 6px 15px; border-radius: 20px; border: 1px solid var(--brd); background: var(--card); color: var(--txt); font-size: 12px; white-space: nowrap; cursor: pointer; }
  .cat-btn.active { background: var(--p); color: #fff; border-color: var(--p); }
  .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; padding: 15px; }
  .product { background: var(--card); padding: 12px; border-radius: 15px; text-align: center; border: 1px solid var(--brd); position: relative; }
  .gallery-container { width: 100%; height: 180px; position: relative; border-radius: 10px; overflow: hidden; background: #eee; margin-bottom: 10px; }
  .gallery-container img { width: 100%; height: 100%; object-fit: cover; }
  .nav-tap { position: absolute; top: 0; width: 30%; height: 100%; z-index: 5; cursor: pointer; }
  .nav-left { left: 0; }
  .nav-right { right: 0; }
  .center-tap { position: absolute; top: 0; left: 30%; width: 40%; height: 100%; z-index: 6; cursor: zoom-in; }
  .dots { position: absolute; bottom: 8px; width: 100%; display: flex; justify-content: center; gap: 4px; z-index: 7; }
  .dot { width: 5px; height: 5px; background: rgba(255,255,255,0.4); border-radius: 50%; }
  .dot.active { background: #fff; transform: scale(1.4); }
  #lb { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 5000; justify-content: center; align-items: center; }
  #lb-img { max-width: 95%; max-height: 80%; object-fit: contain; }
  .lb-ctrl { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); color: white; padding: 20px 15px; border: none; font-size: 24px; z-index: 5001; }
  .del-btn { position: absolute; top: -5px; right: -5px; background: var(--err); color: #fff; border-radius: 50%; width: 28px; height: 28px; z-index: 20; border: 2px solid #fff; cursor: pointer; display: none; }
  #admin-panel { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); padding: 25px; border-radius: 20px; border: 2px solid var(--p); z-index: 3000; width: 90%; max-width: 380px; }
  .cart { position: fixed; right: -100%; top: 0; width: 100%; max-width: 380px; height: 100%; background: var(--card); padding: 20px; transition: 0.4s; z-index: 2000; overflow-y: auto; }
  .cart.open { right: 0; box-shadow: -5px 0 20px rgba(0,0,0,0.1); }
  .del-box { flex: 1; border: 1px solid var(--brd); padding: 12px; border-radius: 10px; text-align: center; cursor: pointer; font-weight: bold; }
  .del-box.active { border-color: var(--p); background: rgba(106, 92, 255, 0.1); color: var(--p); }
  input, select { width: 100%; padding: 12px; margin-top: 10px; border: 1px solid var(--brd); border-radius: 10px; background: var(--bg); color: var(--txt); }
  .btn-p { background: var(--p); color: #fff; width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
</style>
</head>
<body data-theme="light">

<header>
  <h2 id="admin-trigger">ColorShop</h2>
  <div style="display:flex; align-items:center; gap:8px;">
    <button onclick="toggleTheme()" style="background:none; border:none; color:#fff; font-size:20px;">üåì</button>
    <button onclick="toggleCart()" style="background:#fff; color:var(--p); border:none; padding: 8px 12px; border-radius:8px; font-weight:bold;">üõí <span id="cart-count">0</span></button>
  </div>
</header>

<div class="tools">
  <div class="search-row">
    <input type="text" id="search-bar" placeholder="Search..." oninput="draw()">
    <select id="sort-select" onchange="draw()">
      <option value="new">Latest</option>
      <option value="low">Price ‚Üë</option>
      <option value="high">Price ‚Üì</option>
    </select>
  </div>
  <div class="cats" id="cat-list"></div>
</div>

<div class="products" id="grid"></div>

<div id="lb">
    <span style="position:absolute; top:20px; right:20px; color:white; font-size:35px; cursor:pointer;" onclick="closeZoom()">&times;</span>
    <button class="lb-ctrl" style="left:10px;" onclick="zoomSwap(-1)">&#10094;</button>
    <img id="lb-img">
    <button class="lb-ctrl" style="right:10px;" onclick="zoomSwap(1)">&#10095;</button>
</div>

<div id="admin-panel">
  <h3>Settings</h3>
  <input id="n-name" placeholder="Name">
  <input id="n-price" type="number" placeholder="Price (DA)">
  <input id="n-cat" placeholder="Category">
  <input id="n-files" type="file" multiple accept="image/*" style="margin-top:10px;">
  <button onclick="addItem()" class="btn-p" style="margin-top:20px;">Upload to Cloud</button>
  <div style="display:flex; gap:10px; margin-top:10px;">
    <button onclick="logout()" style="flex:1; background:#eee; padding:10px; border:none; border-radius:10px;">Exit</button>
    <button onclick="clearAll()" style="flex:1; background:var(--err); color:#fff; padding:10px; border:none; border-radius:10px;">Wipe Shop</button>
  </div>
</div>

<div class="cart" id="cart-panel">
  <div style="display:flex; justify-content:space-between; align-items:center;"><h3>Checkout</h3><button onclick="toggleCart()" style="background:none; border:none; font-size:30px;">&times;</button></div>
  <div id="cart-list"></div>
  <h3 style="text-align:right;">Total: <span id="cart-total">0</span> DA</h3>
  <input id="c-name" placeholder="Full Name"><input id="c-phone" type="tel" placeholder="Phone"><select id="c-wilaya"></select>
  <div style="display:flex; gap:10px; margin-top:10px;"><div class="del-box active" id="m-home" onclick="setDel('Home')">üè† Home</div><div class="del-box" id="m-desk" onclick="setDel('Stop Desk')">üì¶ Desk</div></div>
  <button class="btn-p" style="margin-top:20px; background:#333;" onclick="checkout()">Email Order</button>
</div>

<script>
// --- REPLACE THIS WITH YOUR FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID"
};
// ----------------------------------------------

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const PASS = "1234";
const MY_EMAIL = "fullshopdz@gmail.com";
let items = [], cart = [], isAdmin = false, delMode = "Home", curCat = "All", galleryState = {}, activeZoomId = null;

// Listen for Data
db.ref('products').on('value', (snap) => {
  const data = snap.val();
  items = data ? Object.keys(data).map(key => ({...data[key], fbKey: key})) : [];
  draw();
});
const firebaseConfig = {
  apiKey: "AIzaSyC8wtssEyyIgD5x3JLV_miPsoMrgvD9EDM",
  authDomain: "colorshop-933e7.firebaseapp.com",
  databaseURL: "https://colorshop-933e7-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "colorshop-933e7",
  storageBucket: "colorshop-933e7.firebasestorage.app",
  messagingSenderId: "152473838882",
  appId: "1:152473838882:web:28950a880135c16f1a717b",
  measurementId: "G-WM4L9PG1PY"
};
function draw() {
    const g = document.getElementById("grid");
    const s = document.getElementById("search-bar").value.toLowerCase();
    const sort = document.getElementById("sort-select").value;
    g.innerHTML = "";
    let filtered = items.filter(i => (curCat==="All" || i.cat===curCat) && i.name.toLowerCase().includes(s));
    if(sort === "low") filtered.sort((a,b) => a.price - b.price);
    else if(sort === "high") filtered.sort((a,b) => b.price - a.price);
    else if(sort === "new") filtered.reverse();
    filtered.forEach(p => {
        const curIdx = galleryState[p.id] || 0;
        let dots = p.imgs.length > 1 ? `<div class="dots">${p.imgs.map((_,i)=>`<div class="dot ${i===curIdx?'active':''}"></div>`).join('')}</div>` : '';
        g.innerHTML += `<div class="product">
            <button class="del-btn" style="display:${isAdmin?'block':'none'}" onclick="deleteItem('${p.fbKey}')">√ó</button>
            <div class="gallery-container">
                <div class="nav-tap nav-left" onclick="swapGallery(${p.id}, -1)"></div>
                <div class="center-tap" onclick="openZoom(${p.id})"></div>
                <div class="nav-tap nav-right" onclick="swapGallery(${p.id}, 1)"></div>
                <img src="${p.imgs[curIdx]}">${dots}
            </div>
            <h4>${p.name}</h4><p style="color:var(--p); font-weight:bold;">${p.price} DA</p>
            <button onclick="addToCart(${p.id})" class="btn-p">Add to Cart</button>
        </div>`;
    });
    updateCats();
}

function swapGallery(id, dir) {
    const p = items.find(x => x.id === id);
    let cur = galleryState[id] || 0;
    cur = (cur + dir + p.imgs.length) % p.imgs.length;
    galleryState[id] = cur;
    draw();
}

function openZoom(id) {
    activeZoomId = id; const p = items.find(x => x.id === id);
    document.getElementById('lb-img').src = p.imgs[galleryState[id] || 0];
    document.getElementById('lb').style.display = 'flex';
}

function zoomSwap(dir) {
    if(!activeZoomId) return;
    const p = items.find(x => x.id === activeZoomId);
    let cur = galleryState[activeZoomId] || 0;
    cur = (cur + dir + p.imgs.length) % p.imgs.length;
    galleryState[activeZoomId] = cur;
    document.getElementById('lb-img').src = p.imgs[cur];
    draw();
}

function closeZoom() { document.getElementById('lb').style.display = 'none'; activeZoomId = null; }

async function addItem() {
    const n = document.getElementById('n-name').value, p = document.getElementById('n-price').value, c = document.getElementById('n-cat').value || "All", files = document.getElementById('n-files').files;
    if(!n || !p || files.length === 0) return alert("Fill all fields!");
    let imgList = [];
    for(let f of files) {
        const b64 = await new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result); rd.readAsDataURL(f); });
        imgList.push(b64);
    }
    db.ref('products').push({ id: Date.now(), name: n, price: parseInt(p), cat: c, imgs: imgList });
    alert("Uploaded to Cloud!");
}

let tapCount = 0, tapTimer;
document.getElementById('admin-trigger').onclick = () => {
    tapCount++; clearTimeout(tapTimer);
    if (tapCount === 4) { if(prompt("Pass:") === PASS) { isAdmin = true; document.getElementById('admin-panel').style.display='block'; draw(); } tapCount = 0; }
    tapTimer = setTimeout(() => tapCount = 0, 1000);
};

function deleteItem(key) { if(confirm("Delete?")) db.ref('products/'+key).remove(); }
function clearAll() { if(confirm("Clear All?")) db.ref('products').remove(); }
function logout() { isAdmin = false; document.getElementById('admin-panel').style.display='none'; draw(); }
function toggleCart() { document.getElementById('cart-panel').classList.toggle('open'); }
function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme')==='dark'?'light':'dark'); }
function addToCart(id) { const i = items.find(x=>x.id===id); const ex = cart.find(x=>x.id===id); if(ex) ex.qty++; else cart.push({...i, qty:1}); updateCart(); }
function updateCart() {
    let t = 0, c = 0; document.getElementById('cart-list').innerHTML = cart.map(i => { t += i.price*i.qty; c += i.qty; return `<div>${i.name} (x${i.qty})</div>`; }).join('');
    document.getElementById('cart-total').innerText = t; document.getElementById('cart-count').innerText = c;
}
function updateCats() {
    const categories = ["All", ...new Set(items.map(i => i.cat))];
    document.getElementById('cat-list').innerHTML = categories.map(c => `<button class="cat-btn ${curCat===c?'active':''}" onclick="curCat='${c}'; draw()">${c}</button>`).join('');
}
function checkout() { alert("Check email logic..."); } // Add your email logic back here

draw();
</script>
</body>
</html>
